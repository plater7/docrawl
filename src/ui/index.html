<!DOCTYPE html>
<!-- ü§ñ Generated with AI assistance by DocCrawler üï∑Ô∏è (model: qwen3-coder:free) and human review. -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docrawl // SYNTHWAVE interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323&family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0a12;
            --bg-panel: #12121f;
            --bg-input: #0d0d18;
            --accent-magenta: #ff00ff;
            --accent-cyan: #00ffff;
            --accent-amber: #ff6b00;
            --accent-green: #00ff88;
            --text-primary: #e0e0e0;
            --text-dim: #6a6a8a;
            --chrome-border: linear-gradient(180deg, #3a3a5a 0%, #1a1a2a 50%, #2a2a4a 100%);
            --glow-magenta: 0 0 10px #ff00ff, 0 0 20px #ff00ff40;
            --glow-cyan: 0 0 10px #00ffff, 0 0 20px #00ffff40;
            --glow-amber: 0 0 10px #ff6b00, 0 0 20px #ff6b0040;
            --scanline-opacity: 0.03;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'VT323', monospace;
            background: var(--bg-deep);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1.5rem;
            padding-bottom: 3rem;
            font-size: 18px;
            line-height: 1.4;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 255, var(--scanline-opacity)) 2px,
                    rgba(0, 255, 255, var(--scanline-opacity)) 4px
                ),
                linear-gradient(180deg, #0a0a12 0%, #0f0f1a 50%, #0a0a12 100%);
            pointer-events: none;
            z-index: 1000;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at 50% 0%, rgba(255, 0, 255, 0.1) 0%, transparent 60%);
            pointer-events: none;
            z-index: -1;
        }

        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            position: relative;
            z-index: 1001;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            margin-bottom: 1.5rem;
            background: linear-gradient(90deg, var(--accent-magenta), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: var(--glow-magenta);
            position: relative;
            display: inline-block;
        }

        h1::before {
            content: '//';
            color: var(--accent-cyan);
            margin-right: 0.5em;
            opacity: 0.7;
        }

        h1::after {
            content: 'DOCUMENTATION FLEET COMMAND';
            position: absolute;
            bottom: -1.5rem;
            left: 0;
            font-size: 0.5rem;
            letter-spacing: 0.5em;
            color: var(--text-dim);
            font-family: 'VT323', monospace;
            font-weight: normal;
        }

        /* Status Bar - Systems Diagnostics Panel */
        .status-bar {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-panel);
            border: 1px solid #2a2a4a;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            box-shadow: 
                inset 0 1px 0 rgba(255,255,255,0.05),
                0 0 20px rgba(0,0,0,0.5);
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: linear-gradient(180deg, #1a1a2a 0%, #0d0d18 100%);
            border: 1px solid #2a2a4a;
            border-radius: 2px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-dim);
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.5);
        }

        .status-dot.ok { 
            background: var(--accent-green); 
            box-shadow: var(--glow-cyan), inset 0 1px 2px rgba(0,0,0,0.3);
            animation: blink-green 2s infinite;
        }

        .status-dot.warning { 
            background: var(--accent-amber); 
            box-shadow: var(--glow-amber);
            animation: blink-amber 1s infinite;
        }

        .status-dot.error { 
            background: #ff3366; 
            box-shadow: 0 0 10px #ff3366;
        }

        .status-dot.loading { 
            background: var(--accent-cyan); 
            box-shadow: var(--glow-cyan);
            animation: pulse 1s infinite;
        }

        @keyframes blink-green { 0%, 90%, 100% { opacity: 1; } 95% { opacity: 0.5; } }
        @keyframes blink-amber { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0.5; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        .status-label { 
            color: var(--accent-cyan); 
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .status-value { 
            color: var(--text-primary); 
            font-size: 0.9rem;
        }

        /* Form Groups */
        .form-group { margin-bottom: 1rem; }

        label {
            display: block;
            margin-bottom: 0.4rem;
            color: var(--accent-cyan);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        label span {
            color: var(--text-dim);
            font-size: 0.8rem;
            text-transform: none;
            letter-spacing: 0;
        }

        input, select {
            width: 100%;
            padding: 0.7rem 1rem;
            background: var(--bg-input);
            border: 1px solid #2a2a4a;
            border-radius: 2px;
            color: var(--accent-green);
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            transition: all 0.2s;
            box-shadow: 
                inset 0 2px 4px rgba(0,0,0,0.3),
                0 0 0 1px transparent;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-magenta);
            box-shadow: 
                inset 0 2px 4px rgba(0,0,0,0.3),
                0 0 15px rgba(255, 0, 255, 0.3),
                inset 0 0 10px rgba(255, 0, 255, 0.1);
            color: var(--accent-magenta);
        }

        input::placeholder { color: #3a3a5a; }

        input[type="url"] {
            background: var(--bg-input);
            position: relative;
        }

        input[type="url"]::before {
            content: '>';
            position: absolute;
            left: 1rem;
            color: var(--accent-cyan);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .row { grid-template-columns: 1fr; }
        }

        /* Checkbox - Retro toggle */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            appearance: none;
            background: var(--bg-input);
            border: 2px solid #3a3a5a;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .checkbox-group input[type="checkbox"]:checked {
            background: var(--accent-magenta);
            border-color: var(--accent-magenta);
            box-shadow: var(--glow-magenta);
        }

        .checkbox-group input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--bg-deep);
            font-weight: bold;
            font-size: 14px;
        }

        .checkbox-group label {
            margin: 0;
            color: var(--text-primary);
            text-transform: none;
            letter-spacing: 0;
            cursor: pointer;
        }

        /* Models Section - Holographic Panel */
        .models-section {
            margin-bottom: 1rem;
            background: linear-gradient(180deg, #15152a 0%, #0d0d1a 100%);
            border: 1px solid #2a2a5a;
            border-radius: 4px;
            padding: 1rem;
            box-shadow: 
                0 0 30px rgba(0, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .models-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent);
        }

        .section-label {
            display: block;
            color: var(--accent-magenta);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin-bottom: 0.75rem;
            text-shadow: var(--glow-magenta);
        }

        .model-row {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .model-row:last-child { margin-bottom: 0; }

        .model-select { flex: 1; min-width: 0; }

        .model-select label {
            font-size: 0.8rem;
            color: var(--accent-amber);
            margin-bottom: 0.25rem;
        }

        .model-hint {
            flex: 0 0 auto;
            max-width: 280px;
            display: flex;
            align-items: flex-start;
            gap: 0.35rem;
            padding-top: 1.5rem;
            font-size: 0.75rem;
            color: var(--text-dim);
            line-height: 1.3;
        }

        .hint-icon { color: #4a4a6a; flex-shrink: 0; }

        @media (max-width: 640px) {
            .model-row { flex-direction: column; }
            .model-hint { padding-top: 0; max-width: 100%; }
        }

        /* Buttons */
        .buttons { display: flex; gap: 1rem; margin-top: 1.5rem; }

        button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 2px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(180deg, #ff00ff 0%, #aa00aa 100%);
            color: white;
            box-shadow: var(--glow-magenta), inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .btn-primary:hover { 
            background: linear-gradient(180deg, #ff33ff 0%, #cc00cc 100%);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: #3a3a4a;
            color: #6a6a8a;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(180deg, #ff3366 0%, #cc0033 100%);
            color: white;
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.5);
            display: none;
        }

        .btn-danger:hover { 
            background: linear-gradient(180deg, #ff4477 0%, #ff0044 100%);
            transform: translateY(-2px);
        }

        /* Phase Banner - HUD Element */
        .phase-banner {
            margin-top: 1.5rem;
            margin-bottom: 0;
            padding: 0.6rem 1rem;
            background: var(--bg-panel);
            border: 1px solid #2a2a4a;
            border-left: 3px solid var(--accent-cyan);
            border-radius: 0 4px 4px 0;
            display: none;
            align-items: center;
            gap: 0.75rem;
            font-family: 'VT323', monospace;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .phase-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .phase-banner.active { display: flex; }

        .phase-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-cyan);
            box-shadow: var(--glow-cyan);
            animation: pulse 1.5s ease-in-out infinite;
        }

        .phase-name {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.2rem 0.5rem;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid var(--accent-cyan);
            border-radius: 2px;
        }

        .phase-separator { color: #4a4a6a; }
        .phase-detail { color: var(--text-dim); }

        /* Phase Colors */
        .phase-init .phase-name { color: #8a8aaa; border-color: #8a8aaa; background: rgba(138, 138, 170, 0.1); }
        .phase-discovery .phase-name { color: #ffaa00; border-color: #ffaa00; background: rgba(255, 170, 0, 0.1); }
        .phase-discovery .phase-dot { background: #ffaa00; box-shadow: 0 0 10px #ffaa00; }
        .phase-filtering .phase-name { color: #aa66ff; border-color: #aa66ff; background: rgba(170, 102, 255, 0.1); }
        .phase-filtering .phase-dot { background: #aa66ff; box-shadow: 0 0 10px #aa66ff; }
        .phase-scraping .phase-name { color: #00aaff; border-color: #00aaff; background: rgba(0, 170, 255, 0.1); }
        .phase-scraping .phase-dot { background: #00aaff; box-shadow: 0 0 10px #00aaff; }
        .phase-cleanup .phase-name { color: #00ffaa; border-color: #00ffaa; background: rgba(0, 255, 170, 0.1); }
        .phase-cleanup .phase-dot { background: #00ffaa; box-shadow: 0 0 10px #00ffaa; }
        .phase-save .phase-name { color: #66ff66; border-color: #66ff66; background: rgba(102, 255, 102, 0.1); }
        .phase-save .phase-dot { background: #66ff66; box-shadow: 0 0 10px #66ff66; }
        .phase-done .phase-name { color: var(--accent-green); border-color: var(--accent-green); background: rgba(0, 255, 136, 0.1); }
        .phase-done .phase-dot { background: var(--accent-green); box-shadow: var(--glow-cyan); animation: none; }
        .phase-failed .phase-name { color: #ff3366; border-color: #ff3366; background: rgba(255, 51, 102, 0.1); }
        .phase-failed .phase-dot { background: #ff3366; box-shadow: 0 0 10px #ff3366; animation: none; }
        .phase-cancelled .phase-name { color: #ff8800; border-color: #ff8800; background: rgba(255, 136, 0, 0.1); }
        .phase-cancelled .phase-dot { background: #ff8800; box-shadow: 0 0 10px #ff8800; animation: none; }

        /* Log Console - CRT Terminal */
        .log {
            margin-top: 0;
            padding: 1rem;
            background: #080810;
            border: 1px solid #2a2a4a;
            border-radius: 0 0 4px 4px;
            font-family: 'VT323', monospace;
            font-size: 0.95rem;
            max-height: 350px;
            overflow-y: auto;
            position: relative;
        }

        .log::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 1px,
                    rgba(0, 255, 255, 0.02) 1px,
                    rgba(0, 255, 255, 0.02) 2px
                );
            pointer-events: none;
        }

        .log-entry { 
            padding: 0.2rem 0; 
            border-bottom: 1px solid #1a1a2a;
            position: relative;
        }

        .log-entry.error { color: #ff3366; text-shadow: 0 0 5px rgba(255, 51, 102, 0.5); }
        .log-entry.success { color: var(--accent-green); text-shadow: 0 0 5px rgba(0, 255, 136, 0.5); }
        .log-entry.info { color: var(--accent-cyan); }
        .log-entry.warning { color: var(--accent-amber); text-shadow: 0 0 5px rgba(255, 107, 0, 0.5); }

        .log-badge {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            border-radius: 2px;
            font-size: 0.7rem;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-right: 0.5rem;
            min-width: 60px;
            text-align: center;
        }

        .badge-init { background: #1a1a2a; color: #8a8aaa; border: 1px solid #3a3a5a; }
        .badge-discovery { background: #2a1a00; color: #ffaa00; border: 1px solid #4a3a00; }
        .badge-filtering { background: #1a0a2a; color: #aa66ff; border: 1px solid #3a1a4a; }
        .badge-scraping { background: #001a2a; color: #00aaff; border: 1px solid #003a4a; }
        .badge-cleanup { background: #002a1a; color: #00ffaa; border: 1px solid #004a3a; }
        .badge-save { background: #001a1a; color: #66ff66; border: 1px solid #003a3a; }
        .badge-done { background: #002a0a; color: var(--accent-green); border: 1px solid #004a1a; }
        .badge-failed { background: #2a001a; color: #ff3366; border: 1px solid #4a003a; }

        .log-model {
            color: #5a5a7a;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        /* Summary Panel - Mission Report */
        .summary {
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: linear-gradient(135deg, #0d0d1a 0%, #15152a 100%);
            border: 1px solid #2a2a5a;
            border-radius: 4px;
            display: none;
            position: relative;
            overflow: hidden;
        }

        .summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-magenta), var(--accent-cyan), var(--accent-green));
        }

        .summary h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--accent-magenta);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
            text-shadow: var(--glow-magenta);
        }

        .stat {
            display: inline-block;
            margin-right: 1.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #2a2a4a;
            border-radius: 2px;
        }

        .stat-value { 
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem; 
            font-weight: 700;
            color: var(--accent-cyan);
            text-shadow: var(--glow-cyan);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        #fetchStats {
            margin-top: 1rem;
            font-family: 'VT323', monospace;
            font-size: 0.9rem;
            color: var(--accent-green);
            display: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a12; }
        ::-webkit-scrollbar-thumb { background: #2a2a4a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3a3a5a; }

        /* Mobile */
        @media (max-width: 480px) {
            body { padding: 1rem; }
            h1 { font-size: 1.8rem; }
            .status-bar { flex-direction: column; gap: 0.5rem; }
            .buttons { flex-direction: column; }
            button { width: 100%; }
        }

        /* Theme Selector */
        .theme-selector {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1002;
        }
        .theme-selector select {
            width: auto;
            padding: 0.4rem 0.75rem;
            background: var(--bg-input);
            border: 1px solid #2a2a4a;
            border-radius: 2px;
            color: var(--accent-cyan);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            cursor: pointer;
        }
        body.theme-basic .theme-selector select {
            background: #1e293b;
            border-color: #334155;
            color: #e2e8f0;
            font-family: system-ui, -apple-system, sans-serif;
            border-radius: 0.5rem;
        }

        /* Basic Theme */
        body.theme-basic {
            font-family: system-ui, -apple-system, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            padding: 2rem;
        }
        body.theme-basic::before, body.theme-basic::after { display: none; }
        body.theme-basic .container { max-width: 800px; }
        body.theme-basic h1 {
            font-family: system-ui, -apple-system, sans-serif;
            font-weight: 700;
            font-size: 1.75rem;
            background: none;
            -webkit-text-fill-color: #f8fafc;
            text-shadow: none;
            margin-bottom: 1.5rem;
        }
        body.theme-basic h1::before, body.theme-basic h1::after { display: none; }
        body.theme-basic .status-bar {
            background: #1e293b;
            border-color: #334155;
            margin-bottom: 1.5rem;
        }
        body.theme-basic .status-item {
            background: #0f172a;
            border-color: #334155;
        }
        body.theme-basic .status-dot { background: #64748b; }
        body.theme-basic .status-dot.ok { background: #22c55e; animation: none; }
        body.theme-basic .status-dot.warning { background: #f59e0b; animation: none; }
        body.theme-basic .status-dot.error { background: #ef4444; animation: none; }
        body.theme-basic .status-dot.loading { background: #3b82f6; animation: pulse-basic 1s infinite; }
        body.theme-basic .status-label { color: #94a3b8; }
        body.theme-basic .status-value { color: #e2e8f0; }
        body.theme-basic label { color: #94a3b8; font-size: 0.875rem; }
        body.theme-basic input, body.theme-basic select {
            background: #1e293b;
            border-color: #334155;
            color: #e2e8f0;
            border-radius: 0.5rem;
            box-shadow: none;
        }
        body.theme-basic input:focus, body.theme-basic select:focus {
            border-color: #3b82f6;
            box-shadow: none;
        }
        body.theme-basic .models-section {
            background: #1a2332;
            border-color: #334155;
            border-radius: 0.5rem;
        }
        body.theme-basic .section-label { color: #e2e8f0; font-weight: 600; }
        body.theme-basic .model-hint { color: #64748b; }
        body.theme-basic .checkbox-group input[type="checkbox"] {
            background: #1e293b;
            border-color: #334155;
        }
        body.theme-basic .checkbox-group input[type="checkbox"]:checked { background: #3b82f6; border-color: #3b82f6; }
        body.theme-basic .btn-primary {
            background: #3b82f6;
            box-shadow: none;
        }
        body.theme-basic .btn-primary:hover { background: #2563eb; }
        body.theme-basic .btn-danger { background: #ef4444; }
        body.theme-basic .phase-banner { background: #1e293b; border-color: #334155; }
        body.theme-basic .phase-dot { background: #3b82f6; animation: pulse-basic 1.5s infinite; }
        body.theme-basic .log {
            background: #1e293b;
            border-color: #334155;
            font-family: monospace;
            border-radius: 0.5rem;
        }
        body.theme-basic .log::before { display: none; }
        body.theme-basic .log-entry { border-color: #334155; }
        body.theme-basic .summary { background: #1e293b; border-radius: 0.5rem; }
        @keyframes pulse-basic { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes blink-term { 50% { opacity: 0; } }

        /* ‚îÄ‚îÄ Terminal (Archival) Theme ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        body.theme-terminal {
            font-family: 'IBM Plex Mono', monospace;
            background: #060908;
            color: #3ddc84;
            padding: 1.5rem;
            font-size: 14px;
        }
        body.theme-terminal::before {
            background:
                repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(0,0,0,.12) 3px,rgba(0,0,0,.12) 4px),
                radial-gradient(ellipse 90% 80% at 50% 40%,transparent 55%,rgba(0,0,0,.65) 100%);
        }
        body.theme-terminal::after { background: none; }
        body.theme-terminal .container { max-width: 820px; }
        /* header */
        body.theme-terminal h1 {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.05rem;
            font-weight: 700;
            background: none;
            -webkit-text-fill-color: #00ff6a;
            color: #00ff6a;
            text-shadow: 0 0 18px #00ff6a;
            letter-spacing: .18em;
            border: 1px solid #3ddc84;
            box-shadow: 0 0 8px #3ddc84;
            display: block;
            padding: .45rem .8rem;
            margin-bottom: .9rem;
            animation: none;
        }
        body.theme-terminal h1::before { content: '‚ñä  '; color: #00ff6a; margin-right: 0; opacity: 1; }
        body.theme-terminal h1::after {
            content: 'DOCUMENTATION ARCHIVAL SYSTEM  v1.0';
            font-size: .55rem;
            letter-spacing: .3em;
            color: #4a7055;
            text-shadow: none;
            font-family: 'IBM Plex Mono', monospace;
            bottom: -1.3rem;
        }
        /* status bar */
        body.theme-terminal .status-bar {
            background: #0b110d;
            border: 1px solid #1a2d20;
            border-top: 2px solid #3ddc84;
            border-radius: 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: .68rem;
            box-shadow: none;
            margin-bottom: 1rem;
        }
        body.theme-terminal .status-item {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
        }
        body.theme-terminal .status-dot { background: #2d4a36; border-radius: 0; width: 6px; height: 6px; box-shadow: none; }
        body.theme-terminal .status-dot.ok { background: #3ddc84; box-shadow: 0 0 6px #3ddc84; animation: none; }
        body.theme-terminal .status-dot.warning { background: #ffb300; box-shadow: none; animation: none; }
        body.theme-terminal .status-dot.error { background: #ff4d4d; box-shadow: none; animation: none; }
        body.theme-terminal .status-dot.loading { background: #3ddc84; box-shadow: none; animation: blink-term .9s step-end infinite; }
        body.theme-terminal .status-label { color: #4a7055; font-family: 'IBM Plex Mono', monospace; }
        body.theme-terminal .status-value { color: #3ddc84; font-family: 'IBM Plex Mono', monospace; font-weight: 500; }
        /* form */
        body.theme-terminal label {
            font-family: 'IBM Plex Mono', monospace;
            color: #4a7055;
            font-size: .65rem;
            text-transform: uppercase;
            letter-spacing: .1em;
        }
        body.theme-terminal input, body.theme-terminal select {
            font-family: 'IBM Plex Mono', monospace;
            background: #0f1a12;
            border: 1px solid #1a2d20;
            border-radius: 0;
            color: #00ff6a;
            box-shadow: none;
            font-size: .78rem;
            caret-color: #00ff6a;
        }
        body.theme-terminal input:focus, body.theme-terminal select:focus { border-color: #3ddc84; box-shadow: none; }
        body.theme-terminal select option { background: #0f1a12; }
        /* models section */
        body.theme-terminal .models-section { background: #0b110d; border: 1px solid #1a2d20; border-radius: 0; }
        body.theme-terminal .section-label { font-family: 'IBM Plex Mono', monospace; color: #4a7055; font-size: .65rem; letter-spacing: .14em; font-weight: 400; }
        body.theme-terminal .model-hint { color: #2d4a36; font-family: 'IBM Plex Mono', monospace; font-size: .62rem; }
        body.theme-terminal .model-hint span { color: #1a2d20; }
        /* checkboxes */
        body.theme-terminal .checkbox-group input[type=checkbox] { background: #0f1a12; border-color: #1a2d20; border-radius: 0; box-shadow: none; }
        body.theme-terminal .checkbox-group input[type=checkbox]:checked { background: #04200e; border-color: #3ddc84; }
        body.theme-terminal .checkbox-group label { color: #6a9a78; font-family: 'IBM Plex Mono', monospace; font-size: .72rem; text-transform: none; letter-spacing: 0; }
        /* buttons */
        body.theme-terminal .btn-primary {
            font-family: 'IBM Plex Mono', monospace;
            background: transparent;
            border: 1px solid #3ddc84;
            color: #3ddc84;
            border-radius: 0;
            box-shadow: none;
            letter-spacing: .1em;
            text-transform: uppercase;
        }
        body.theme-terminal .btn-primary:hover { background: #04200e; box-shadow: 0 0 8px #3ddc84; }
        body.theme-terminal .btn-primary:disabled { border-color: #2d4a36; color: #2d4a36; background: transparent; box-shadow: none; }
        body.theme-terminal .btn-danger { font-family: 'IBM Plex Mono', monospace; background: transparent; border: 1px solid #ff4d4d; color: #ff4d4d; border-radius: 0; box-shadow: none; }
        body.theme-terminal .btn-danger:hover { background: #200505; box-shadow: none; }
        /* phase banner */
        body.theme-terminal .phase-banner {
            background: #0b110d;
            border: 1px solid #1a2d20;
            border-radius: 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: .72rem;
        }
        body.theme-terminal .phase-dot { background: #3ddc84; box-shadow: 0 0 6px #3ddc84; width: 6px; height: 6px; border-radius: 0; animation: blink-term 1.2s step-end infinite; }
        body.theme-terminal .phase-name { font-family: 'IBM Plex Mono', monospace; background: transparent; border: none; padding: 0; font-size: .72rem; letter-spacing: .12em; color: #3ddc84; text-shadow: none; }
        body.theme-terminal .phase-separator { color: #2d4a36; }
        body.theme-terminal .phase-detail { color: #4a7055; font-family: 'IBM Plex Mono', monospace; font-size: .68rem; }
        /* phase colors */
        body.theme-terminal .phase-discovery .phase-name { color: #ffb300; background: transparent; border: none; text-shadow: none; }
        body.theme-terminal .phase-discovery .phase-dot { background: #ffb300; box-shadow: 0 0 6px #ffb300; }
        body.theme-terminal .phase-filtering .phase-name { color: #c97bea; background: transparent; border: none; text-shadow: none; }
        body.theme-terminal .phase-filtering .phase-dot { background: #c97bea; box-shadow: none; }
        body.theme-terminal .phase-scraping .phase-name { color: #6ab4f5; background: transparent; border: none; text-shadow: none; }
        body.theme-terminal .phase-scraping .phase-dot { background: #6ab4f5; box-shadow: none; }
        body.theme-terminal .phase-cleanup .phase-name { color: #5ec8d4; background: transparent; border: none; text-shadow: none; }
        body.theme-terminal .phase-cleanup .phase-dot { background: #5ec8d4; box-shadow: none; }
        body.theme-terminal .phase-done .phase-name { color: #00ff6a; background: transparent; border: none; text-shadow: 0 0 10px #00ff6a; }
        body.theme-terminal .phase-done .phase-dot { background: #00ff6a; box-shadow: 0 0 10px #00ff6a; animation: none; }
        body.theme-terminal .phase-failed .phase-name { color: #ff4d4d; background: transparent; border: none; text-shadow: none; }
        body.theme-terminal .phase-failed .phase-dot { background: #ff4d4d; box-shadow: none; animation: none; }
        body.theme-terminal .phase-cancelled .phase-name { color: #ffb300; background: transparent; border: none; text-shadow: none; }
        body.theme-terminal .phase-cancelled .phase-dot { background: #ffb300; box-shadow: none; animation: none; }
        /* log */
        body.theme-terminal .log {
            background: #0b110d;
            border: 1px solid #1a2d20;
            border-radius: 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: .7rem;
        }
        body.theme-terminal .log::before { display: none; }
        body.theme-terminal .log-entry { border-color: #0e1f13; color: #8dbfa0; }
        body.theme-terminal .log-entry.error { color: #ff4d4d; text-shadow: none; }
        body.theme-terminal .log-entry.success { color: #00ff6a; text-shadow: none; }
        body.theme-terminal .log-entry.info { color: #6ab4f5; }
        body.theme-terminal .log-entry.warning { color: #ffb300; text-shadow: none; }
        body.theme-terminal .log-badge { font-family: 'IBM Plex Mono', monospace; font-size: .58rem; border-radius: 0; min-width: 56px; }
        body.theme-terminal .badge-init { background: transparent; color: #4a7055; border: 1px solid #2d4a36; }
        body.theme-terminal .badge-discovery { background: #180d00; color: #fbbf24; border: none; }
        body.theme-terminal .badge-filtering { background: #180826; color: #c97bea; border: none; }
        body.theme-terminal .badge-scraping { background: #020e1e; color: #6ab4f5; border: none; }
        body.theme-terminal .badge-cleanup { background: #021418; color: #5ec8d4; border: none; }
        body.theme-terminal .badge-save, body.theme-terminal .badge-done { background: #04200e; color: #00ff6a; border: none; }
        body.theme-terminal .badge-failed { background: #1c0000; color: #ff4d4d; border: none; }
        body.theme-terminal .log-model { color: #2d4a36; font-family: 'IBM Plex Mono', monospace; }
        /* summary */
        body.theme-terminal .summary { background: #0b110d; border: 1px solid #3ddc84; border-radius: 0; box-shadow: inset 0 0 20px rgba(0,255,106,.04); }
        body.theme-terminal .summary::before { display: none; }
        body.theme-terminal .summary h3 { font-family: 'IBM Plex Mono', monospace; color: #4a7055; font-size: .6rem; letter-spacing: .2em; text-shadow: none; }
        body.theme-terminal .stat { background: transparent; border: none; padding: 0; margin-right: 2rem; }
        body.theme-terminal .stat-value { font-family: 'IBM Plex Mono', monospace; color: #00ff6a; text-shadow: 0 0 14px #00ff6a; font-size: 1.35rem; }
        body.theme-terminal .stat-label { font-family: 'IBM Plex Mono', monospace; color: #4a7055; font-size: .58rem; }
        body.theme-terminal #fetchStats { font-family: 'IBM Plex Mono', monospace; color: #4a7055; font-size: .67rem; }
        /* theme selector */
        body.theme-terminal .theme-selector select {
            font-family: 'IBM Plex Mono', monospace;
            background: #0b110d;
            border: 1px solid #1a2d20;
            color: #3ddc84;
            border-radius: 0;
        }
        /* scrollbar */
        body.theme-terminal ::-webkit-scrollbar-track { background: #060908; }
        body.theme-terminal ::-webkit-scrollbar-thumb { background: #1a2d20; border-radius: 0; }
        body.theme-terminal ::-webkit-scrollbar-thumb:hover { background: #253d2c; }

        /* ‚îÄ‚îÄ App Footer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .app-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1001;
            text-align: center;
            padding: 0.45rem 1rem;
            font-size: 0.72em;
            color: var(--text-dim);
            letter-spacing: 0.05em;
            background: rgba(0,0,0,0.55);
            backdrop-filter: blur(4px);
        }
        .app-footer .footer-name { font-weight: bold; color: var(--text-primary); opacity: 0.7; }
        .app-footer .footer-sep { opacity: 0.3; margin: 0 0.45em; }
        .app-footer .footer-link { color: var(--accent-cyan); text-decoration: none; opacity: 0.75; }
        .app-footer .footer-link:hover { opacity: 1; text-shadow: var(--glow-cyan); }
        .app-footer .footer-models { opacity: 0.55; }
        body.theme-terminal .app-footer { color: rgba(61,220,132,0.45); font-family: 'IBM Plex Mono', monospace; font-size: 0.62em; }
        body.theme-terminal .app-footer .footer-name { color: rgba(61,220,132,0.7); }
        body.theme-terminal .app-footer .footer-link { color: #00ff6a; opacity: 0.6; text-shadow: none; }
        body.theme-terminal .app-footer .footer-link:hover { opacity: 1; text-shadow: 0 0 8px #00ff6a; }
        body.theme-basic .app-footer { color: #64748b; font-family: monospace; }
        body.theme-basic .app-footer .footer-name { color: #94a3b8; }
        body.theme-basic .app-footer .footer-link { color: #3b82f6; opacity: 0.85; text-shadow: none; }
        body.theme-basic .app-footer .footer-link:hover { opacity: 1; }
    </style>
</head>
<body>
    <!-- Theme Selector -->
    <div class="theme-selector">
        <select id="themeSelect">
            <option value="synthwave">SYNTHWAVE</option>
            <option value="basic">BASIC</option>
            <option value="terminal">TERMINAL</option>
        </select>
    </div>

    <div class="container">
        <h1>Docrawl</h1>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div class="status-item">
                <span class="status-dot loading" id="ollamaDot"></span>
                <span class="status-label">Ollama:</span>
                <span class="status-value" id="ollamaStatus">INIT...</span>
            </div>
            <div class="status-item">
                <span class="status-dot loading" id="diskDot"></span>
                <span class="status-label">Disk:</span>
                <span class="status-value" id="diskStatus">INIT...</span>
            </div>
            <div class="status-item">
                <span class="status-dot loading" id="writeDot"></span>
                <span class="status-label">Write:</span>
                <span class="status-value" id="writeStatus">INIT...</span>
            </div>
        </div>

        <form id="crawlForm">
            <div class="form-group">
                <label for="url">[URL] Target Documentation</label>
                <input type="url" id="url" required placeholder="https://docs.example.com">
            </div>

            <div class="form-group">
                <label for="provider">// LLM Provider</label>
                <select id="provider">
                    <option value="ollama">‚óà OLLAMA (Local)</option>
                    <option value="openrouter">‚óâ OPENROUTER (API)</option>
                    <option value="opencode">‚óâ OPENCODE (API)</option>
                </select>
            </div>

            <!-- Data exfiltration warning ‚Äî closes CONS-021 / issue #67 -->
            <div id="externalProviderWarning" style="display:none;background:#3a1a1a;border:1px solid #c06060;color:#e08080;padding:8px 12px;margin:8px 0;font-size:0.85em;">
                &#9888; External provider selected ‚Äî scraped content will be sent to a third-party API.
            </div>

            <div class="models-section">
                <label class="section-label">// Neural Network Configuration</label>

                <div class="model-row">
                    <div class="model-select">
                        <label for="crawlModel">‚ñ∏ Crawl Model</label>
                        <select id="crawlModel" required>
                            <option value="">Loading models...</option>
                        </select>
                    </div>
                    <div class="model-hint">
                        <span class="hint-icon">‚óà</span>
                        <span class="hint-text" id="crawlHint">URL discovery & filtering. Modelos rapidos: 3b-8b.</span>
                    </div>
                </div>

                <div class="model-row">
                    <div class="model-select">
                        <label for="pipelineModel">‚ñ∏ Pipeline Model</label>
                        <select id="pipelineModel" required>
                            <option value="">Loading models...</option>
                        </select>
                    </div>
                    <div class="model-hint">
                        <span class="hint-icon">‚óà</span>
                        <span class="hint-text" id="pipelineHint">Markdown cleanup. 6b-14b (incluye 8b y quant).</span>
                    </div>
                </div>

                <div class="model-row">
                    <div class="model-select">
                        <label for="reasoningModel">‚ñ∏ Reasoning Model</label>
                        <select id="reasoningModel" required>
                            <option value="">Loading models...</option>
                        </select>
                    </div>
                    <div class="model-hint">
                        <span class="hint-icon">‚óà</span>
                        <span class="hint-text" id="reasoningHint">Analisis complejo. Modelos grandes: +14b o reasoning.</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="outputPath">[PATH] Output Directory <span>(auto-generated from URL)</span></label>
                <input type="text" id="outputPath" value="/data/output">
            </div>

            <div class="row">
                <div class="form-group">
                    <label for="delayMs">[MS] Request Delay</label>
                    <input type="number" id="delayMs" value="500" min="0">
                </div>
                <div class="form-group">
                    <label for="maxConcurrent">[N] Max Concurrent</label>
                    <input type="number" id="maxConcurrent" value="3" min="1" max="10">
                </div>
            </div>

            <div class="row">
                <div class="form-group">
                    <label for="maxDepth">[N] Max Depth</label>
                    <input type="number" id="maxDepth" value="5" min="1" max="20">
                </div>
                <div class="form-group">
                    <label for="language">[LANG] Language Filter</label>
                    <select id="language">
                        <option value="en">English (en)</option>
                        <option value="es">Spanish (es)</option>
                        <option value="fr">French (fr)</option>
                        <option value="de">German (de)</option>
                        <option value="ja">Japanese (ja)</option>
                        <option value="zh">Chinese (zh)</option>
                        <option value="pt">Portuguese (pt)</option>
                        <option value="all">All Languages</option>
                    </select>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="respectRobots" checked>
                <label for="respectRobots">Respect robots.txt Protocol</label>
            </div>

            <div class="models-section" style="margin-top: 1rem;">
                <label class="section-label">// Markdown Optimization</label>
                <div class="checkbox-group" style="margin-bottom: 0.75rem;">
                    <input type="checkbox" id="useNativeMarkdown" checked>
                    <label for="useNativeMarkdown">Native Markdown (Accept: text/markdown)</label>
                </div>
                <div class="checkbox-group" style="margin-bottom: 0.75rem;">
                    <input type="checkbox" id="useMarkdownProxy">
                    <label for="useMarkdownProxy">Use markdown proxy as fallback</label>
                </div>
                <div class="form-group" id="proxyUrlGroup" style="display: none;">
                    <label for="markdownProxyUrl">[URL] Proxy Endpoint</label>
                    <input type="text" id="markdownProxyUrl" value="https://markdown.new" placeholder="https://markdown.new">
                </div>
            </div>

            <div class="buttons">
                <button type="submit" class="btn-primary" id="startBtn">‚ñ∂ EXECUTE CRAWL</button>
                <button type="button" class="btn-danger" id="cancelBtn">‚ñ† ABORT</button>
            </div>
        </form>

        <div class="phase-banner" id="phaseBanner">
            <span class="phase-dot" id="phaseDot"></span>
            <span class="phase-name" id="phaseName">INIT</span>
            <span class="phase-separator">‚îÇ</span>
            <span class="phase-detail" id="phaseDetail"></span>
        </div>
        <div class="log" id="log"></div>

        <div class="summary" id="summary">
            <h3>// Mission Report</h3>
            <div>
                <span class="stat"><span class="stat-value" id="pagesOk">0</span><br><span class="stat-label">Complete</span></span>
                <span class="stat"><span class="stat-value" id="pagesPartial">0</span><br><span class="stat-label">Partial</span></span>
                <span class="stat"><span class="stat-value" id="pagesFailed">0</span><br><span class="stat-label">Failed</span></span>
            </div>
            <div id="fetchStats"></div>
        </div>
    </div>

    <footer class="app-footer">
        <span class="footer-name">üï∑Ô∏è Docrawl</span>
        <span class="footer-sep">¬∑</span>
        <span id="footerVersion">v0.9.6a</span>
        <span class="footer-sep">¬∑</span>
        <a class="footer-link" href="https://github.com/plater7/docrawl" target="_blank" rel="noopener">github.com/plater7/docrawl</a>
        <span class="footer-sep">¬∑</span>
        <span class="footer-author">by plater7</span>
        <span class="footer-sep">¬∑</span>
        <span class="footer-models">models: <span id="footerModels">qwen3-coder:free ¬∑ glm-4.7-free ¬∑ claude-sonnet-4-6</span></span>
    </footer>

    <script>
        // Theme management
        const themeSelect = document.getElementById('themeSelect');
        const savedTheme = localStorage.getItem('docrawl-theme') || 'synthwave';
        document.body.className = `theme-${savedTheme}`;
        themeSelect.value = savedTheme;
        themeSelect.addEventListener('change', () => {
            document.body.className = `theme-${themeSelect.value}`;
            localStorage.setItem('docrawl-theme', themeSelect.value);
        });

        const form = document.getElementById('crawlForm');
        const startBtn = document.getElementById('startBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const logDiv = document.getElementById('log');
        const summaryDiv = document.getElementById('summary');
        const phaseBanner = document.getElementById('phaseBanner');
        const phaseDot = document.getElementById('phaseDot');
        const phaseName = document.getElementById('phaseName');
        const phaseDetail = document.getElementById('phaseDetail');

        const providerSelect = document.getElementById('provider');
        const crawlModelSelect = document.getElementById('crawlModel');
        const pipelineModelSelect = document.getElementById('pipelineModel');
        const reasoningModelSelect = document.getElementById('reasoningModel');

        const useMarkdownProxyCheckbox = document.getElementById('useMarkdownProxy');
        const proxyUrlGroup = document.getElementById('proxyUrlGroup');
        useMarkdownProxyCheckbox.addEventListener('change', () => {
            proxyUrlGroup.style.display = useMarkdownProxyCheckbox.checked ? 'block' : 'none';
        });

        let currentJobId = null;
        let eventSource = null;

        function getModelCategory(modelName, modelSize) {
            const name = modelName.toLowerCase();
            const size = modelSize || 0;
            const reasoningPatterns = ['r1', 'reasoning', 'deepseek', 'qwen3:32', 'qwen3:30', 'qwq', 'o1', 'o3', 'o4', 'claude-haiku', 'moonshot', 'kimi'];
            if (reasoningPatterns.some(p => name.includes(p)) || size > 20000000000) return 'reasoning';
            const crawlPatterns = ['1b', '2b', '3b', '4b', '5b', 'phi', 'tiny', 'mini', 'gemma:2', 'mistral:7'];
            if (crawlPatterns.some(p => name.includes(p)) && !name.includes('8b') || size < 4000000000) return 'crawl';
            const pipelinePatterns = ['6b', '7b', '8b', 'qwen', 'llama3.1', 'llama3:7', 'mistral', 'mixtral', 'gemma'];
            if (pipelinePatterns.some(p => name.includes(p)) || (size >= 4000000000 && size <= 16000000000)) return 'pipeline';
            return 'pipeline';
        }

        function filterModelsForSelector(models, selectorType) {
            return models.filter(m => {
                const category = getModelCategory(m.name, m.size);
                switch (selectorType) {
                    case 'crawl': return category === 'crawl';
                    case 'pipeline': return category === 'pipeline' || category === 'reasoning';
                    case 'reasoning': return category === 'reasoning' || category === 'pipeline';
                    default: return true;
                }
            });
        }

        function generateDynamicHints(models, provider) {
            const hints = { crawl: [], pipeline: [], reasoning: [] };
            const freeHints = { crawl: [], pipeline: [], reasoning: [] };
            models.forEach(m => {
                const category = getModelCategory(m.name, m.size);
                if (hints[category]) {
                    hints[category].push(m.name);
                    if (m.is_free) freeHints[category].push(m.name);
                }
            });
            const topN = 3;
            const updateHint = (elementId, modelList, freeList, fallbackDesc, providerType) => {
                const el = document.getElementById(elementId);
                if (!el) return;
                const isLocal = providerType === 'ollama';
                const priorityList = freeList.length > 0 ? freeList : modelList;
                if (priorityList.length > 0) {
                    const suggestions = priorityList.slice(0, topN).join(', ');
                    const badge = isLocal ? '‚óà LOCAL' : '‚óâ FREE';
                    el.textContent = '';
                    el.appendChild(document.createTextNode(fallbackDesc));
                    el.appendChild(document.createElement('br'));
                    const strong = document.createElement('strong');
                    strong.textContent = `Suggestions (${badge}):`;
                    el.appendChild(strong);
                    el.appendChild(document.createTextNode(' ' + suggestions));
                } else {
                    el.textContent = fallbackDesc;
                }
            };
            const providerType = provider;
            updateHint('crawlHint', hints.crawl, freeHints.crawl, 'URL discovery & filtering. Fast: 3b-8b.', providerType);
            updateHint('pipelineHint', hints.pipeline, freeHints.pipeline, 'Markdown cleanup. 6b-14b.', providerType);
            updateHint('reasoningHint', hints.reasoning, freeHints.reasoning, 'Complex analysis. Large: +14b.', providerType);
        }

        async function loadModels() {
            const selects = [crawlModelSelect, pipelineModelSelect, reasoningModelSelect];
            const selectorTypes = ['crawl', 'pipeline', 'reasoning'];
            const provider = providerSelect.value;
            try {
                const res = await fetch(`/api/models?provider=${provider}`);
                const models = await res.json();
                if (models.length === 0) {
                    selects.forEach(s => {
                        s.innerHTML = '';
                        const opt = document.createElement('option');
                        opt.value = '';
                        opt.textContent = `No ${provider} models available`;
                        s.appendChild(opt);
                    });
                    logMessage(`No ${provider} models available. Check API key or Ollama connection.`, 'init', 'warning');
                    return;
                }
                generateDynamicHints(models, provider);
                const isLocal = provider === 'ollama';
                const badge = isLocal ? '‚óà' : '‚óâ';
                selects.forEach((select, index) => {
                    const filteredModels = filterModelsForSelector(models, selectorTypes[index]);
                    let modelsToShow = filteredModels.length > 0 ? filteredModels : models;
                    modelsToShow.sort((a, b) => {
                        if (a.is_free !== b.is_free) return b.is_free ? 1 : -1;
                        return a.name.localeCompare(b.name);
                    });
                    select.innerHTML = '';
                    modelsToShow.forEach(m => {
                        const modelBadge = m.is_free ? ` ${badge}` : '';
                        const opt = document.createElement('option');
                        opt.value = m.name;
                        opt.textContent = m.name + modelBadge;
                        select.appendChild(opt);
                    });
                });
            } catch (e) {
                selects.forEach(s => {
                    s.innerHTML = '';
                    const opt = document.createElement('option');
                    opt.value = '';
                    opt.textContent = 'Error loading models';
                    s.appendChild(opt);
                });
                logMessage(`Failed to load ${provider} models`, 'init', 'error');
            }
        }

        providerSelect.addEventListener('change', () => {
            loadModels();
            checkExternalProvider(providerSelect.value);
        });

        // Data exfiltration warning ‚Äî closes CONS-021 / issue #67
        function checkExternalProvider(provider) {
            const warning = document.getElementById('externalProviderWarning');
            if (!warning) return;
            if (provider !== 'ollama') {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }
        }

        function updateOutputPath() {
            const urlInput = document.getElementById('url').value.trim();
            if (!urlInput) {
                document.getElementById('outputPath').value = '/data/output';
                return;
            }
            try {
                const parsed = new URL(urlInput);
                let domain = parsed.hostname.replace(/^(www|docs|doc|documentation|wiki)\./i, '');
                let section = parsed.pathname.replace(/\/$/, '').replace(/^\/(latest|stable|v\d[^/]*)/i, '').replace(/^\/docs?\/?/i, '').replace(/^\//, '');
                let outputPath = `/data/output/${domain}`;
                if (section) {
                    const parts = section.split('/').filter(Boolean);
                    if (parts.length > 3) section = parts[0] + '/' + parts[parts.length - 1];
                    else section = parts.join('/');
                    outputPath += `/${section}`;
                }
                document.getElementById('outputPath').value = outputPath;
            } catch (e) { }
        }

        function updatePhaseBanner(phase, detail) {
            phaseBanner.className = `phase-banner phase-${phase} active`;
            phaseName.textContent = phase;
            phaseDetail.textContent = detail || '';
        }

        function hidePhaseBanner() {
            phaseBanner.className = 'phase-banner';
        }

        function logMessage(message, phase, level) {
            // Build DOM nodes directly ‚Äî no innerHTML with untrusted data (closes CONS-004 / issue #52)
            const entry = document.createElement('div');
            const levelClass = level === 'error' ? 'error' : level === 'warning' ? 'warning' : level === 'success' ? 'success' : '';
            entry.className = `log-entry ${levelClass}`;

            const time = new Date().toLocaleTimeString();
            const timeSpan = document.createElement('span');
            timeSpan.style.color = '#4a4a6a';
            timeSpan.textContent = `[${time}]`;
            entry.appendChild(timeSpan);
            entry.appendChild(document.createTextNode(' '));

            if (phase) {
                const badgeSpan = document.createElement('span');
                badgeSpan.className = `log-badge badge-${phase}`;
                badgeSpan.textContent = phase;
                entry.appendChild(badgeSpan);
            }

            const msgSpan = document.createElement('span');
            msgSpan.textContent = message;
            entry.appendChild(msgSpan);

            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function setRunning(running) {
            startBtn.disabled = running;
            cancelBtn.style.display = running ? 'block' : 'none';
            if (!running) hidePhaseBanner();
        }

        async function startCrawl(e) {
            e.preventDefault();
            logDiv.innerHTML = '';
            summaryDiv.style.display = 'none';
            const payload = {
                url: document.getElementById('url').value,
                crawl_model: crawlModelSelect.value,
                pipeline_model: pipelineModelSelect.value,
                reasoning_model: reasoningModelSelect.value,
                output_path: document.getElementById('outputPath').value,
                delay_ms: parseInt(document.getElementById('delayMs').value),
                max_concurrent: parseInt(document.getElementById('maxConcurrent').value),
                max_depth: parseInt(document.getElementById('maxDepth').value),
                respect_robots_txt: document.getElementById('respectRobots').checked,
                use_native_markdown: document.getElementById('useNativeMarkdown').checked,
                use_markdown_proxy: useMarkdownProxyCheckbox.checked,
                markdown_proxy_url: document.getElementById('markdownProxyUrl').value,
                language: document.getElementById('language').value,
            };
            try {
                const res = await fetch('/api/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                const job = await res.json();
                currentJobId = job.id;
                logMessage(`Job initialized: ${job.id}`, 'init', 'info');
                setRunning(true);
                subscribeToEvents(job.id);
            } catch (e) {
                logMessage(`Failed to start job: ${e.message}`, 'init', 'error');
            }
        }

        function subscribeToEvents(jobId) {
            eventSource = new EventSource(`/api/jobs/${jobId}/events`);
            eventSource.addEventListener('phase_change', (e) => {
                const data = JSON.parse(e.data);
                let detail = data.message || '';
                if (data.active_model) detail += ` ‚óà ${data.active_model}`;
                if (data.progress) detail += ` // ${data.progress}`;
                updatePhaseBanner(data.phase, detail);
            });
            eventSource.addEventListener('log', (e) => {
                const data = JSON.parse(e.data);
                // active_model appended as plain text in logMessage ‚Äî no XSS (closes CONS-004 / issue #52)
                const msg = data.active_model
                    ? `${data.message} [${data.active_model}]`
                    : data.message;
                logMessage(msg, data.phase, data.level || '');
            });
            eventSource.addEventListener('discovery', (e) => {
                const data = JSON.parse(e.data);
                logMessage(`${data.phase} - ${data.status || ''} ${data.urls_found ? `(${data.urls_found} URLs)` : ''}`, 'discovery');
            });
            eventSource.addEventListener('filtering', (e) => {
                const data = JSON.parse(e.data);
                logMessage(`${data.phase} ${data.after_basic ? `(${data.after_basic} URLs)` : ''} ${data.after_llm ? `‚Üí ${data.after_llm} URLs` : ''}`, 'filtering');
            });
            eventSource.addEventListener('page_start', (e) => {
                const data = JSON.parse(e.data);
                logMessage(`[${data.index}/${data.total}] LOADING: ${data.url}`, 'scraping', 'info');
            });
            eventSource.addEventListener('page_done', (e) => {
                const data = JSON.parse(e.data);
                const msg = data.chunks_failed > 0 ? `DONE (${data.chunks_failed}/${data.chunks_total} failed)` : '‚úì COMPLETE';
                logMessage(`  ‚Üí ${msg}`, 'save', data.status === 'ok' ? 'success' : 'warning');
            });
            eventSource.addEventListener('page_error', (e) => {
                const data = JSON.parse(e.data);
                logMessage(`  ‚Üí ERROR: ${data.error}`, 'scraping', 'error');
            });
            eventSource.addEventListener('job_done', (e) => {
                const data = JSON.parse(e.data);
                if (data.status === 'completed') {
                    updatePhaseBanner('done', `Output: ${data.output_path}`);
                    logMessage(`Mission complete! ${data.pages_ok} OK, ${data.pages_partial || 0} partial, ${data.pages_failed || 0} failed`, 'done', 'success');
                } else {
                    updatePhaseBanner('failed', data.error || 'Unknown error');
                    logMessage(`Mission failed: ${data.error}`, 'failed', 'error');
                }
                showSummary(data);
                cleanupJob();
            });
            eventSource.addEventListener('job_cancelled', (e) => {
                const data = JSON.parse(e.data);
                updatePhaseBanner('cancelled', `${data.pages_completed}/${data.pages_total} processed`);
                logMessage(`Operation aborted. ${data.pages_completed}/${data.pages_total} pages processed.`, 'cancelled');
                cleanupJob();
            });
            eventSource.addEventListener('keepalive', () => {});
            eventSource.onerror = (e) => {
                if (!currentJobId) return;
                if (eventSource) { eventSource.close(); eventSource = null; }
                fetch(`/api/jobs/${currentJobId}/status`)
                    .then(r => { if (!r.ok) throw new Error(`Status ${r.status}`); return r.json(); })
                    .then(status => {
                        if (status.status === 'running' || status.status === 'pending') {
                            logMessage('SSE reconnecting...', 'init', 'warning');
                            setTimeout(() => { if (currentJobId) subscribeToEvents(currentJobId); }, 2000);
                        } else if (status.status === 'completed') {
                            updatePhaseBanner('done', 'Completed');
                            logMessage('Job completed.', 'done');
                            cleanupJob();
                        } else if (status.status === 'cancelled') {
                            updatePhaseBanner('cancelled', `${status.pages_completed}/${status.pages_total}`);
                            logMessage(`Cancelled. ${status.pages_completed}/${status.pages_total} pages.`, 'cancelled');
                            cleanupJob();
                        } else {
                            logMessage('Job failed.', 'failed', 'error');
                            cleanupJob();
                        }
                    })
                    .catch(() => {
                        setTimeout(() => {
                            if (!currentJobId) return;
                            fetch(`/api/jobs/${currentJobId}/status`)
                                .then(r => r.ok ? r.json() : Promise.reject())
                                .then(status => {
                                    if (status.status === 'running') subscribeToEvents(currentJobId);
                                    else { logMessage('Connection lost', 'failed', 'error'); cleanupJob(); }
                                })
                                .catch(() => { logMessage('Connection lost ‚Äî server may have restarted', 'failed', 'error'); cleanupJob(); });
                        }, 5000);
                    });
            };
        }

        async function cancelJob() {
            if (!currentJobId) return;
            try {
                await fetch(`/api/jobs/${currentJobId}/cancel`, { method: 'POST' });
                logMessage('Aborting operation...', 'init', 'info');
            } catch (e) {
                logMessage(`Failed to cancel: ${e.message}`, 'init', 'error');
            }
        }

        function showSummary(data) {
            document.getElementById('pagesOk').textContent = data.pages_ok || 0;
            document.getElementById('pagesPartial').textContent = data.pages_partial || 0;
            document.getElementById('pagesFailed').textContent = data.pages_failed || 0;
            summaryDiv.style.display = 'block';
            const nativeMd = data.pages_native_md || 0;
            const proxyMd = data.pages_proxy_md || 0;
            const playwright = data.pages_playwright || 0;
            if (nativeMd > 0 || proxyMd > 0) {
                const statsDiv = document.getElementById('fetchStats');
                const lines = [];
                if (nativeMd > 0) lines.push(`‚ö° ${nativeMd} via native markdown`);
                if (proxyMd > 0) lines.push(`‚óà ${proxyMd} via markdown proxy`);
                if (playwright > 0) lines.push(`‚óâ ${playwright} via Playwright`);
                statsDiv.textContent = '';
                lines.forEach((line, i) => {
                    statsDiv.appendChild(document.createTextNode(line));
                    if (i < lines.length - 1) statsDiv.appendChild(document.createElement('br'));
                });
                statsDiv.style.display = 'block';
            }
        }

        function cleanupJob() {
            if (eventSource) { eventSource.close(); eventSource = null; }
            currentJobId = null;
            setRunning(false);
        }

        document.getElementById('url').addEventListener('input', updateOutputPath);
        form.addEventListener('submit', startCrawl);
        cancelBtn.addEventListener('click', cancelJob);
        loadModels();
        checkHealth();

        async function checkHealth() {
            const ollamaDot = document.getElementById('ollamaDot');
            const ollamaStatus = document.getElementById('ollamaStatus');
            const diskDot = document.getElementById('diskDot');
            const diskStatus = document.getElementById('diskStatus');
            const writeDot = document.getElementById('writeDot');
            const writeStatus = document.getElementById('writeStatus');
            try {
                const res = await fetch('/api/health/ready');
                const data = await res.json();
                const ollama = data.checks.ollama || {};
                if (ollama.status === 'ok') { ollamaDot.className = 'status-dot ok'; ollamaStatus.textContent = `${ollama.models_count} models`; }
                else if (ollama.status === 'unreachable') { ollamaDot.className = 'status-dot error'; ollamaStatus.textContent = 'OFFLINE'; }
                else { ollamaDot.className = 'status-dot warning'; ollamaStatus.textContent = ollama.status || 'ERROR'; }
                const disk = data.checks.disk_space || {};
                if (disk.status === 'ok') { diskDot.className = 'status-dot ok'; diskStatus.textContent = `${disk.free_gb}GB free`; }
                else if (disk.status === 'warning') { diskDot.className = 'status-dot warning'; diskStatus.textContent = `${disk.free_gb}GB (low)`; }
                else if (disk.status === 'critical') { diskDot.className = 'status-dot error'; diskStatus.textContent = `${disk.free_gb}GB (crit)`; }
                else { diskDot.className = 'status-dot warning'; diskStatus.textContent = disk.status || 'UNKNOWN'; }
                const write = data.checks.write_permissions || {};
                if (write.status === 'ok') { writeDot.className = 'status-dot ok'; writeStatus.textContent = 'OK'; }
                else if (write.status === 'denied') { writeDot.className = 'status-dot error'; writeStatus.textContent = 'DENIED'; }
                else { writeDot.className = 'status-dot warning'; writeStatus.textContent = write.status || 'UNKNOWN'; }
            } catch (e) {
                ollamaDot.className = 'status-dot error'; ollamaStatus.textContent = 'ERROR';
                diskDot.className = 'status-dot error'; diskStatus.textContent = 'ERROR';
                writeDot.className = 'status-dot error'; writeStatus.textContent = 'ERROR';
            }
        }

        // Populate footer with live version from /api/info
        (async () => {
            try {
                const info = await fetch('/api/info').then(r => r.json());
                if (info.version) document.getElementById('footerVersion').textContent = 'v' + info.version;
                if (info.models_used) document.getElementById('footerModels').textContent = info.models_used.join(' ¬∑ ');
            } catch (_) { /* keep static fallback values */ }
        })();
    </script>
</body>
</html>
